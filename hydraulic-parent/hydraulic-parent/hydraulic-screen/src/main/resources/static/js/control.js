webpackJsonp([1],{"+skl":function(t,a){},1:function(t,a,e){t.exports=e("J9oB")},HVf8:function(t,a){},IUPf:function(t,a){},J9oB:function(t,a,e){"use strict";function l(t){e("IUPf")}Object.defineProperty(a,"__esModule",{value:!0});var o=e("4bK6"),r=e.n(o),i=e("BTaQ"),n=e.n(i),s=e("fC7K"),c=(e("+skl"),e("HVf8"),e("//Fk")),m=e.n(c),u=e("mtWM"),d=e.n(u),p={ROOT:"/screen"};p.ajax=d.a.create({baseURL:p.ROOT,timeout:12e4,responseType:"json"}),p.ajax.interceptors.response.use(function(t){return t.data},function(t){return m.a.reject(t)});var f=p,v=e("mw3O"),h=e.n(v),g={name:"control",data:function(){return{selectStationId:1,selectStationName:"",setDrawer:!1,isAlarm:!1,insideVal:.01,foreVal:.01,outsideVal:.01,timer:"",receiverList:[],stationList:[],pumpData:[],pumpCount:4,frequencyList:["5","10","15","30","45","60"],alarmDialogModal:{modal:!1,closable:!1,loading:!1},alarmForm:{id:null,stationId:1,alarmName:"",alarmLine:0,frequency:5,receivers:[],status:0}}},methods:{init:function(){var t=this;this.getStationList(),this.getWaterLine(),this.getPumpData(),this.timer=setInterval(function(){t.initData()},1e4)},initData:function(){this.getWaterLine(),this.getPumpData()},getPumpCount:function(){var t=this;f.ajax.post("/control/getPumpCount?stationId="+this.selectStationId).then(function(a){null!=a&&(t.pumpCount=a)}).catch(function(t){console.log(t)})},getStationList:function(){var t=this;f.ajax.post("/station/getStationData").then(function(a){null!=a&&(t.stationList=a.stationList,t.selectStationId=a.defaultStation.id,t.selectStationName=a.defaultStation.name)}).catch(function(t){console.log(t)})},stationChange:function(t){this.selectStationId=t.value,this.selectStationName=t.label,this.alarmForm.stationId=t.value,this.initData()},drawerMove:function(){this.setDrawer=!0},getWXReceivers:function(){var t=this;f.ajax.post("/control/getWXReceivers").then(function(a){null!=a&&(t.receiverList=a)}).catch(function(t){console.log(t)})},getPumpData:function(){var t=this;f.ajax.post("/control/getPumpData?stationId="+this.selectStationId).then(function(a){null!=a&&(t.pumpData=a)}).catch(function(t){console.log(t)})},getWaterLine:function(){var t=this;f.ajax.post("/control/getWaterLine?stationId="+this.selectStationId).then(function(a){if("200"===a.code){var e=a.alarmLine;t.insideVal=a.insideVal,t.outsideVal=a.outsideVal,t.foreVal=a.foreVal,0!==e&&t.insideVal>=e?t.isAlarm=!0:t.isAlarm=!1}}).catch(function(t){console.log(t)})},alarmDialogSubmit:function(){var t=this;if(this.alarmDialogModal.loading=!0,this.formValidate()){var a=h.a.stringify(this.alarmForm,{allowDots:!0});f.ajax.post("/control/alarmConfigSave",a).then(function(a){a?t.$Message.success("报警设置成功！"):t.confirmAlert("报警设置失败！")}).catch(function(t){console.log(t)}),this.alarmDialogCancel()}},formValidate:function(){return""==this.alarmForm.alarmName?(this.confirmAlert("报警名称不能为空"),!1):""==this.alarmForm.alarmLine?(this.confirmAlert("报警水位不能为空"),!1):0!=this.alarmForm.receivers.length||(this.confirmAlert("通知人不能为空"),!1)},confirmAlert:function(t){var a="<p>"+t+"</p>";this.$Message.warning({content:a,duration:3})},alarmMessage:function(t){this.$Message.error({background:!0,content:"当前内河水位已超"+t+"米的警戒水位，请及时处置！",top:50,duration:3})},switchChange:function(t){this.alarmForm.status=t?1:0},initAlarmDialog:function(){var t=this;this.getWXReceivers(),f.ajax.post("/control/getAlarmConfig?stationId="+this.alarmForm.stationId).then(function(a){a&&(t.alarmForm.id=a.id,t.alarmForm.alarmName=a.alarmName,t.alarmForm.alarmLine=a.alarmLine,t.alarmForm.receivers=a.receivers,t.alarmForm.frequency=a.frequency,t.alarmForm.status=a.status),t.alarmDialogModal.modal=!0}).catch(function(t){console.log(t)})},alarmDialogCancel:function(){this.alarmDialogModal.modal=!1,this.alarmDialogModal.closable=!0,this.alarmDialogModal.loading=!1,this.alarmForm.id=null,this.alarmForm.status=0,this.alarmForm.frequency=5,this.alarmForm.alarmName="",this.alarmForm.alarmLine=0,this.alarmForm.receivers=[]}},created:function(){this.init()},beforeDestroy:function(){clearInterval(this.timer)}},_=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticStyle:{margin:"10px"},on:{click:t.drawerMove}},[e("Drawer",{attrs:{title:"泵站设置",placement:"left",closable:!1},model:{value:t.setDrawer,callback:function(a){t.setDrawer=a},expression:"setDrawer"}},[e("Select",{staticStyle:{"margin-top":"60px",width:"200px","margin-left":"15px"},attrs:{"label-in-value":!0},on:{"on-change":t.stationChange},model:{value:t.selectStationId,callback:function(a){t.selectStationId=a},expression:"selectStationId"}},t._l(t.stationList,function(a){return e("Option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.name))])}),1),t._v(" "),e("Button",{staticStyle:{"margin-top":"60px","margin-left":"15px",width:"200px"},attrs:{type:"primary"},on:{click:t.initAlarmDialog}},[t._v("水位报警设置")])],1),t._v(" "),e("card",{staticClass:"card-top",attrs:{"dis-hover":""}},[e("p",{staticStyle:{"text-align":"center"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.selectStationName))]),t._v(" "),e("div",[e("card",{staticClass:"card-content",attrs:{"dis-hover":""}},[e("p",{staticStyle:{"font-size":"xx-small"},attrs:{slot:"title"},slot:"title"},[t._v("外河水位")]),t._v("\n        "+t._s(t.outsideVal)+" 米\n      ")]),t._v(" "),e("card",{staticClass:"card-content",attrs:{"dis-hover":""}},[e("p",{staticStyle:{"font-size":"xx-small"},attrs:{slot:"title"},slot:"title"},[t._v("前池水位")]),t._v("\n        "+t._s(t.foreVal)+" 米\n      ")]),t._v(" "),e("card",{staticClass:"card-content",class:t.isAlarm?"warnFont":"",attrs:{"dis-hover":""}},[e("p",{staticStyle:{"font-size":"xx-small"},attrs:{slot:"title"},slot:"title"},[t._v("内河水位")]),t._v("\n        "+t._s(t.insideVal)+" 米\n      ")]),t._v(" "),t._l(t.pumpCount,function(a){return e("div",{key:a,staticStyle:{display:"inline-block"},attrs:{value:a}},[e("card",{staticClass:"card-building",attrs:{"dis-hover":""}},[e("p",{staticStyle:{"font-size":"xx-small"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(a)+"#机组")]),t._v(" "),e("p",[t._v("A相电压:"+t._s(t.pumpData[a-1].va)+"V；A相电流:"+t._s(t.pumpData[a-1].aa)+"A")]),t._v(" "),e("p",[t._v("B相电压:"+t._s(t.pumpData[a-1].vb)+"V；B相电流:"+t._s(t.pumpData[a-1].ab)+"A")]),t._v(" "),e("p",[t._v("C相电压:"+t._s(t.pumpData[a-1].vc)+"V；C相电流:"+t._s(t.pumpData[a-1].ac)+"A")])])],1)})],2)]),t._v(" "),e("Modal",{attrs:{title:"水位告警配置",closable:!1,width:"45",closable:"","mask-closable":t.alarmDialogModal.closable},on:{"on-cancel":t.alarmDialogCancel},model:{value:t.alarmDialogModal.modal,callback:function(a){t.$set(t.alarmDialogModal,"modal",a)},expression:"alarmDialogModal.modal"}},[e("Form",{ref:"alarmForm",attrs:{model:t.alarmForm,"label-width":90}},[e("FormItem",{attrs:{label:"告警名称:",prop:"alarmName"}},[e("Input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入告警名称",maxlength:64},model:{value:t.alarmForm.alarmName,callback:function(a){t.$set(t.alarmForm,"alarmName",a)},expression:"alarmForm.alarmName"}})],1),t._v(" "),e("FormItem",{attrs:{label:"告警水位:",prop:"alarmLine"}},[e("Input",{staticStyle:{width:"70px"},attrs:{type:"number"},model:{value:t.alarmForm.alarmLine,callback:function(a){t.$set(t.alarmForm,"alarmLine",a)},expression:"alarmForm.alarmLine"}}),t._v(" 米\n      ")],1),t._v(" "),e("FormItem",{attrs:{label:"告警开关:",prop:"status"}},[e("i-switch",{attrs:{size:"large"},on:{"on-change":t.switchChange},scopedSlots:t._u([{key:"open",fn:function(){return[e("span",[t._v("ON")])]},proxy:!0},{key:"close",fn:function(){return[e("span",[t._v("OFF")])]},proxy:!0}]),model:{value:1==t.alarmForm.status,callback:function(a){t.$set(t.alarmForm,"status ==1 ?true :false",a)},expression:"alarmForm.status ==1 ?true :false"}})],1),t._v(" "),e("FormItem",{attrs:{label:"告警频率:",prop:"frequency"}},[e("Select",{staticStyle:{width:"100px"},model:{value:t.alarmForm.frequency,callback:function(a){t.$set(t.alarmForm,"frequency",a)},expression:"alarmForm.frequency"}},t._l(t.frequencyList,function(a,l){return e("Option",{key:l,attrs:{value:a}},[t._v(t._s(a)+"分钟/次")])}),1)],1),t._v(" "),e("FormItem",{attrs:{label:"通知人:",prop:"receivers"}},[e("Select",{staticStyle:{width:"400px"},attrs:{multiple:"",filterable:"",placeholder:"请选择通知人"},model:{value:t.alarmForm.receivers,callback:function(a){t.$set(t.alarmForm,"receivers",a)},expression:"alarmForm.receivers"}},t._l(t.receiverList,function(a){return e("Option",{key:a.id,attrs:{value:a.openid}},[t._v(t._s(a.nickName))])}),1)],1)],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"text",size:"large"},on:{click:t.alarmDialogCancel}},[t._v("取消")]),t._v(" "),e("Button",{attrs:{type:"primary",size:"large",loading:t.alarmDialogModal.loading},on:{click:t.alarmDialogSubmit}},[t._v("保存\n      ")])],1)],1)],1)},F=[],x={render:_,staticRenderFns:F},D=x,y=e("VU/8"),S=l,b=y(g,D,!1,S,null,null),I=b.exports;r.a.use(n.a),r.a.use(s.a),new r.a({el:"#control",components:{"control-component":I}})}},[1]);
//# sourceMappingURL=control.js.map